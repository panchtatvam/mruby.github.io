I".<h1 id="mruby-200">mruby 2.0.0</h1>

<p>We are proudly announcing the first stable release of mruby 2.0 series â€“ mruby 2.0.0.</p>

<p>This release includes the improvement of Ruby2.x compatibility and memory consumption.</p>

<hr />
<h2 id="new-features">New Features</h2>

<h3 id="core-language-features">Core Language Features</h3>

<ul>
  <li>Keyword Arguments Implemented (Ruby 2.0 Compatible)</li>
  <li>Argument Deconstructing Implemented</li>
</ul>

<h3 id="core-libraries">Core Libraries</h3>

<h4 id="mruby-kernel-ext">mruby-kernel-ext</h4>
<ul>
  <li><code class="highlighter-rouge">Kernel#then</code> was added as <code class="highlighter-rouge">Kernel#yield_self</code> (Ruby 2.6 Compatible)</li>
</ul>

<h4 id="mruby-array-ext">mruby-array-ext</h4>
<ul>
  <li><code class="highlighter-rouge">Array#to_h</code>  can be called with a block (Ruby 2.6 Compatible)</li>
  <li><code class="highlighter-rouge">Array#union</code> was added (Ruby 2.6 Compatible)</li>
</ul>

<h4 id="mruby-string-ext">mruby-string-ext</h4>
<ul>
  <li><code class="highlighter-rouge">String#lines</code>  can be called with a block</li>
  <li>The following methods are added
<code class="highlighter-rouge">String#tr</code>, <code class="highlighter-rouge">String#tr!</code>, <code class="highlighter-rouge">String#tr_s</code>, <code class="highlighter-rouge">String#tr_s!</code>, <code class="highlighter-rouge">String#squeeze</code>, <code class="highlighter-rouge">String#squeeze!</code>, <code class="highlighter-rouge">String#count</code>, <code class="highlighter-rouge">String#delete</code>, <code class="highlighter-rouge">String#delete!</code></li>
</ul>

<h4 id="mruby-pack">mruby-pack</h4>
<ul>
  <li><code class="highlighter-rouge">String#unpack1</code> was added</li>
</ul>

<h4 id="mruby-metaprog">mruby-metaprog</h4>
<p>Meta-programming features are separated as a mrbgem. You need to link  <code class="highlighter-rouge">mruby-metaprog</code> to use meta-programming. (See <code class="highlighter-rouge">Breaking Changes</code> for more detail)</p>

<h4 id="mruby-sleep">mruby-sleep</h4>
<p><a href="https://github.com/matsumotory/mruby-sleep">matsumotory/mruby-sleep</a> was bundled as a core library.
You can use <code class="highlighter-rouge">Kernel#sleep</code> and <code class="highlighter-rouge">Kernel#usleep</code> methods.</p>

<h3 id="tools">Tools</h3>

<h4 id="mruby-compiler-mrbc">mruby compiler (mrbc)</h4>

<ul>
  <li><code class="highlighter-rouge">--remove-lv</code> option was added
By specifying <code class="highlighter-rouge">--remove-lv</code>, mrbc suppress the generation of local variable information to be used for debugging in the compiled binary. It reduces the size of compiled mruby binary and memory consumption when loaded.</li>
</ul>

<h4 id="mruby-interpreter-mruby">mruby interpreter (mruby)</h4>

<ul>
  <li><code class="highlighter-rouge">-d</code> option was added
By specifying <code class="highlighter-rouge">-d</code>, mruby execute the script in the debugging mode ($DEBUG=true).</li>
  <li><code class="highlighter-rouge">-r</code> option was added
By specifying <code class="highlighter-rouge">-r library</code>, mruby loads the specified library before the execution.</li>
</ul>

<h4 id="interactive-mruby-mirb">interactive mruby (mirb)</h4>

<ul>
  <li><code class="highlighter-rouge">-d</code> option was added (Behaves as <code class="highlighter-rouge">mruby -d</code>)</li>
  <li><code class="highlighter-rouge">-r</code> option was added (Behaves as <code class="highlighter-rouge">mruby -r</code>)</li>
</ul>

<hr />
<h2 id="reducing-memory-consumption">Reducing Memory Consumption</h2>

<p>Several improvements were done in mruby 2.0.0 to reduce memory consumption:</p>

<ul>
  <li>Instance variables are stored in segmented lists</li>
  <li>Hash implementation replaced from khash</li>
  <li><code class="highlighter-rouge">--remove-lv</code> option was added to mruby compiler(mrbc)</li>
  <li>And smaller improvements including VM stack and call frames.</li>
</ul>

<hr />
<h2 id="breaking-changes">Breaking Changes</h2>

<p>There are two major breaking changes from mruby 1.4.1</p>

<h3 id="1-bytecode-overhauled">1. Bytecode Overhauled</h3>

<p>VM instruction format has been completely changed.
The fixed width instruction until mruby 1.4.1 was abandoned. We chose variable length bytecode instructions in mruby 2.0. You need to recompile everything for mruby 2.0.</p>

<ul>
  <li>Binary Format Version: <code class="highlighter-rouge">0005</code></li>
  <li>VM Version: <code class="highlighter-rouge">0002</code></li>
</ul>

<h3 id="2-meta-programming-features-separated-as-mrbgem">2. Meta-programming features separated as mrbgem</h3>

<p>From the assumption that meta-programming features are not frequently used in embedded system development, we separated meta-programming features as a mebgem (<code class="highlighter-rouge">mruby-metaprog</code>). The following methods have moved to <code class="highlighter-rouge">mruby-metaprog</code> gem.</p>

<ul>
  <li>
    <p>Kernel module
global_variables, local_variables, singleton_class, instance_variables, instance_variables_defined?, instance_variable_get, instance_variable_set, methods, private_methods, public_methods, protected_methods, singleton_methods, define_singleton_methods, send</p>
  </li>
  <li>
    <p>Module class
class_variables, class_variables_defined?, class_variable_get, class_variable_set, remove_class_variable, included_modules, instance_methods, remove_method, method_removed, constants</p>
  </li>
  <li>
    <p>Module class (Singleton Methods)<br />
constants, nesting</p>
  </li>
</ul>

<h3 id="3-no-implicit-conversion-by-to_int-and-to_str">3. No implicit conversion by <code class="highlighter-rouge">to_int</code> and <code class="highlighter-rouge">to_str</code>.</h3>

<h2 id="the-objects-with-methods-to_int-or-to_str-are-no-longer-converted-to-integers-or-strings-respectively-those-implicit-conversions-cause-recursive-vm-calls-and-had-been-the-source-of-many-bugs">The objects with methods <code class="highlighter-rouge">to_int</code> or <code class="highlighter-rouge">to_str</code> are no longer converted to Integers or Strings respectively. Those implicit conversions cause recursive VM calls and had been the source of many bugs.</h2>

<p>We have done 378 commits to 156 files, 7,949 lines were added, 5,430 lines removed since mruby1.4.1.
For more detail of the updates, see <a href="https://github.com/mruby/mruby/compare/1.4.1...2.0.0">Commit Log</a>.</p>

<h2 id="evaluated-mrbgems-list-npo-mruby-forum">Evaluated mrbgems list (NPO mruby forum)</h2>

<p><a href="http://forum.mruby.org/download/index2EN.html">See the list</a>.</p>
:ET